<div class="panel">
  <div class="panel__body" *ngIf="node; else empty">
    <div class="panel__header">
      <span>Selected</span>
      <h4>{{ node.meta?.name ?? node.type }}</h4>
    </div>

    <details class="panel-section" open>
      <summary>Content</summary>
      <div class="section-body">
        <ng-container [ngSwitch]="node.type">
          <div *ngSwitchCase="'heading'">
            <div class="control-row">
              <label>Heading text</label>
              <textarea [ngModel]="node.content?.text" (ngModelChange)="updateContent('text', $event)"></textarea>
            </div>
            <div class="control-row">
              <label>Tag</label>
              <select [ngModel]="node.content?.tag" (ngModelChange)="updateContent('tag', $event)">
                <option value="h1">h1</option>
                <option value="h2">h2</option>
                <option value="h3">h3</option>
                <option value="h4">h4</option>
                <option value="h5">h5</option>
                <option value="h6">h6</option>
              </select>
            </div>
          </div>

          <div *ngSwitchCase="'text'">
            <div class="control-row">
              <label>Text</label>
              <textarea [ngModel]="node.content?.text" (ngModelChange)="updateContent('text', $event)"></textarea>
            </div>
          </div>

          <div *ngSwitchCase="'image'">
            <div class="control-row">
              <label>Image URL</label>
              <input [ngModel]="node.content?.src" (ngModelChange)="updateContent('src', $event)" />
            </div>
            <div class="control-row">
              <label>Upload image</label>
              <label class="upload-button">
                <span>{{ uploadingImage ? 'Uploading...' : 'Choose file' }}</span>
                <input type="file" accept="image/*" (change)="handleImageUpload($event)" />
              </label>
            </div>
            <div class="control-row">
              <label>Alt text</label>
              <input [ngModel]="node.content?.alt" (ngModelChange)="updateContent('alt', $event)" />
            </div>
            <div class="hint">Use a URL or upload from your device.</div>
          </div>

          <div *ngSwitchCase="'button'">
            <div class="control-row">
              <label>Label</label>
              <input [ngModel]="node.content?.text" (ngModelChange)="updateContent('text', $event)" />
            </div>
            <div class="control-row">
              <label>Link</label>
              <input [ngModel]="node.content?.href" (ngModelChange)="updateContent('href', $event)" />
            </div>
            <div class="control-row">
              <label>Target</label>
              <select [ngModel]="node.content?.target" (ngModelChange)="updateContent('target', $event)">
                <option value="_self">Same tab</option>
                <option value="_blank">New tab</option>
              </select>
            </div>
          </div>

          <div *ngSwitchCase="'list'">
            <div class="control-row">
              <label>List items</label>
              <textarea [ngModel]="node.content?.text" (ngModelChange)="updateContent('text', $event)"></textarea>
            </div>
            <div class="hint">Use new lines for each list item.</div>
          </div>

          <div *ngSwitchDefault class="hint">This block does not have editable content.</div>
        </ng-container>
      </div>
    </details>

    <details class="panel-section" open>
      <summary>Layout</summary>
      <div class="section-body">
        <div class="control-row">
          <label>Display</label>
          <select [ngModel]="getStyleValue('display', 'block')" (ngModelChange)="updateStyle('display', $event)">
            <option value="block">Block</option>
            <option value="flex">Flex</option>
            <option value="grid">Grid</option>
            <option value="inline">Inline</option>
            <option value="inline-block">Inline-block</option>
            <option value="inline-flex">Inline-flex</option>
            <option value="inline-grid">Inline-grid</option>
            <option value="none">None</option>
          </select>
        </div>

        <div class="control-row" *ngIf="getStyleValue('display') === 'flex' || getStyleValue('display') === 'inline-flex'">
          <label>Direction</label>
          <select [ngModel]="getStyleValue('flexDirection')" (ngModelChange)="updateStyle('flexDirection', $event)">
            <option value="row">Row</option>
            <option value="row-reverse">Row reverse</option>
            <option value="column">Column</option>
            <option value="column-reverse">Column reverse</option>
          </select>
        </div>
        <div class="control-row" *ngIf="getStyleValue('display') === 'flex' || getStyleValue('display') === 'inline-flex'">
          <label>Wrap</label>
          <select [ngModel]="getStyleValue('flexWrap')" (ngModelChange)="updateStyle('flexWrap', $event)">
            <option value="nowrap">No wrap</option>
            <option value="wrap">Wrap</option>
            <option value="wrap-reverse">Wrap reverse</option>
          </select>
        </div>
        <div class="control-row" *ngIf="getStyleValue('display') === 'flex' || getStyleValue('display') === 'inline-flex'">
          <label>Justify</label>
          <select [ngModel]="getStyleValue('justifyContent')" (ngModelChange)="updateStyle('justifyContent', $event)">
            <option value="flex-start">Start</option>
            <option value="center">Center</option>
            <option value="flex-end">End</option>
            <option value="space-between">Space between</option>
            <option value="space-around">Space around</option>
            <option value="space-evenly">Space evenly</option>
          </select>
        </div>
        <div class="control-row" *ngIf="getStyleValue('display') === 'flex' || getStyleValue('display') === 'inline-flex'">
          <label>Align</label>
          <select [ngModel]="getStyleValue('alignItems')" (ngModelChange)="updateStyle('alignItems', $event)">
            <option value="stretch">Stretch</option>
            <option value="flex-start">Start</option>
            <option value="center">Center</option>
            <option value="flex-end">End</option>
          </select>
        </div>
        <div class="control-row" *ngIf="getStyleValue('display') === 'flex' || getStyleValue('display') === 'inline-flex'">
          <label>Align content</label>
          <select [ngModel]="getStyleValue('alignContent')" (ngModelChange)="updateStyle('alignContent', $event)">
            <option value="stretch">Stretch</option>
            <option value="flex-start">Start</option>
            <option value="center">Center</option>
            <option value="flex-end">End</option>
            <option value="space-between">Space between</option>
            <option value="space-around">Space around</option>
          </select>
        </div>

        <div class="control-row" *ngIf="getStyleValue('display') === 'grid' || getStyleValue('display') === 'inline-grid'">
          <label>Columns</label>
          <input
            [ngModel]="getStyleValue('gridTemplateColumns')"
            (ngModelChange)="updateStyle('gridTemplateColumns', $event)"
            placeholder="repeat(2, 1fr)"
          />
        </div>
        <div class="control-row" *ngIf="getStyleValue('display') === 'grid' || getStyleValue('display') === 'inline-grid'">
          <label>Rows</label>
          <input
            [ngModel]="getStyleValue('gridTemplateRows')"
            (ngModelChange)="updateStyle('gridTemplateRows', $event)"
            placeholder="auto"
          />
        </div>
        <div class="control-row" *ngIf="getStyleValue('display') === 'grid' || getStyleValue('display') === 'inline-grid'">
          <label>Justify items</label>
          <select [ngModel]="getStyleValue('justifyItems')" (ngModelChange)="updateStyle('justifyItems', $event)">
            <option value="stretch">Stretch</option>
            <option value="start">Start</option>
            <option value="center">Center</option>
            <option value="end">End</option>
          </select>
        </div>
        <div class="control-row" *ngIf="getStyleValue('display') === 'grid' || getStyleValue('display') === 'inline-grid'">
          <label>Align items</label>
          <select [ngModel]="getStyleValue('alignItems')" (ngModelChange)="updateStyle('alignItems', $event)">
            <option value="stretch">Stretch</option>
            <option value="start">Start</option>
            <option value="center">Center</option>
            <option value="end">End</option>
          </select>
        </div>
        <div class="control-row">
          <label>Gap</label>
          <input [ngModel]="getStyleValue('gap')" (ngModelChange)="updateStyle('gap', $event)" placeholder="16px" />
        </div>
      </div>
    </details>

    <details class="panel-section" open>
      <summary>Spacing</summary>
      <div class="section-body">
        <div class="section-title">
          <h4>Margin</h4>
          <button type="button" class="link-toggle" (click)="linkMargin = !linkMargin">
            {{ linkMargin ? 'Linked' : 'Unlinked' }}
          </button>
        </div>
        <div class="control-row" *ngIf="linkMargin">
          <label>All</label>
          <input [ngModel]="getLinkedSpacingValue('margin')" (ngModelChange)="updateSpacing('margin', 'Top', $event)" />
        </div>
        <div class="control-row" *ngIf="!linkMargin">
          <label>Top</label>
          <input [ngModel]="getStyleValue('marginTop')" (ngModelChange)="updateSpacing('margin', 'Top', $event)" />
        </div>
        <div class="control-row" *ngIf="!linkMargin">
          <label>Right</label>
          <input [ngModel]="getStyleValue('marginRight')" (ngModelChange)="updateSpacing('margin', 'Right', $event)" />
        </div>
        <div class="control-row" *ngIf="!linkMargin">
          <label>Bottom</label>
          <input [ngModel]="getStyleValue('marginBottom')" (ngModelChange)="updateSpacing('margin', 'Bottom', $event)" />
        </div>
        <div class="control-row" *ngIf="!linkMargin">
          <label>Left</label>
          <input [ngModel]="getStyleValue('marginLeft')" (ngModelChange)="updateSpacing('margin', 'Left', $event)" />
        </div>

        <div class="section-title">
          <h4>Padding</h4>
          <button type="button" class="link-toggle" (click)="linkPadding = !linkPadding">
            {{ linkPadding ? 'Linked' : 'Unlinked' }}
          </button>
        </div>
        <div class="control-row" *ngIf="linkPadding">
          <label>All</label>
          <input [ngModel]="getLinkedSpacingValue('padding')" (ngModelChange)="updateSpacing('padding', 'Top', $event)" />
        </div>
        <div class="control-row" *ngIf="!linkPadding">
          <label>Top</label>
          <input [ngModel]="getStyleValue('paddingTop')" (ngModelChange)="updateSpacing('padding', 'Top', $event)" />
        </div>
        <div class="control-row" *ngIf="!linkPadding">
          <label>Right</label>
          <input [ngModel]="getStyleValue('paddingRight')" (ngModelChange)="updateSpacing('padding', 'Right', $event)" />
        </div>
        <div class="control-row" *ngIf="!linkPadding">
          <label>Bottom</label>
          <input [ngModel]="getStyleValue('paddingBottom')" (ngModelChange)="updateSpacing('padding', 'Bottom', $event)" />
        </div>
        <div class="control-row" *ngIf="!linkPadding">
          <label>Left</label>
          <input [ngModel]="getStyleValue('paddingLeft')" (ngModelChange)="updateSpacing('padding', 'Left', $event)" />
        </div>
      </div>
    </details>

    <details class="panel-section" open>
      <summary>Size</summary>
      <div class="section-body">
        <div class="control-row">
          <label>Width</label>
          <input [ngModel]="getStyleValue('width')" (ngModelChange)="updateStyle('width', $event)" placeholder="auto" />
        </div>
        <div class="control-row">
          <label>Height</label>
          <input [ngModel]="getStyleValue('height')" (ngModelChange)="updateStyle('height', $event)" placeholder="auto" />
        </div>
        <div class="control-row">
          <label>Min width</label>
          <input [ngModel]="getStyleValue('minWidth')" (ngModelChange)="updateStyle('minWidth', $event)" placeholder="0" />
        </div>
        <div class="control-row">
          <label>Min height</label>
          <input [ngModel]="getStyleValue('minHeight')" (ngModelChange)="updateStyle('minHeight', $event)" placeholder="0" />
        </div>
        <div class="control-row">
          <label>Max width</label>
          <input [ngModel]="getStyleValue('maxWidth')" (ngModelChange)="updateStyle('maxWidth', $event)" placeholder="none" />
        </div>
        <div class="control-row">
          <label>Max height</label>
          <input [ngModel]="getStyleValue('maxHeight')" (ngModelChange)="updateStyle('maxHeight', $event)" placeholder="none" />
        </div>
        <div class="control-row">
          <label>Overflow</label>
          <select [ngModel]="getStyleValue('overflow')" (ngModelChange)="updateStyle('overflow', $event)">
            <option value="visible">Visible</option>
            <option value="hidden">Hidden</option>
            <option value="scroll">Scroll</option>
            <option value="auto">Auto</option>
          </select>
        </div>
        <div class="control-row" *ngIf="node.type === 'image'">
          <label>Object fit</label>
          <select [ngModel]="getStyleValue('objectFit')" (ngModelChange)="updateStyle('objectFit', $event)">
            <option value="cover">Cover</option>
            <option value="contain">Contain</option>
            <option value="fill">Fill</option>
            <option value="none">None</option>
          </select>
        </div>
      </div>
    </details>

    <details class="panel-section" open>
      <summary>Position</summary>
      <div class="section-body">
        <div class="control-row">
          <label>Position</label>
          <select [ngModel]="getStyleValue('position', 'static')" (ngModelChange)="updateStyle('position', $event)">
            <option value="static">Static</option>
            <option value="relative">Relative</option>
            <option value="absolute">Absolute</option>
            <option value="fixed">Fixed</option>
            <option value="sticky">Sticky</option>
          </select>
        </div>
        <div class="control-row">
          <label>Top</label>
          <input [ngModel]="getStyleValue('top')" (ngModelChange)="updateStyle('top', $event)" />
        </div>
        <div class="control-row">
          <label>Right</label>
          <input [ngModel]="getStyleValue('right')" (ngModelChange)="updateStyle('right', $event)" />
        </div>
        <div class="control-row">
          <label>Bottom</label>
          <input [ngModel]="getStyleValue('bottom')" (ngModelChange)="updateStyle('bottom', $event)" />
        </div>
        <div class="control-row">
          <label>Left</label>
          <input [ngModel]="getStyleValue('left')" (ngModelChange)="updateStyle('left', $event)" />
        </div>
        <div class="control-row">
          <label>Z-index</label>
          <input [ngModel]="getStyleValue('zIndex')" (ngModelChange)="updateStyle('zIndex', $event)" />
        </div>
      </div>
    </details>

    <details class="panel-section" open>
      <summary>Typography</summary>
      <div class="section-body">
        <div class="control-row">
          <label>Font</label>
          <select [ngModel]="getFontFamily()" (ngModelChange)="updateFontFamily($event)">
            <option *ngFor="let font of fontOptions" [value]="font.stack">{{ font.label }}</option>
          </select>
        </div>
        <div class="control-row">
          <label>Weight</label>
          <select [ngModel]="getStyleValue('fontWeight')" (ngModelChange)="updateFontWeight($event)">
            <option *ngFor="let weight of getFontWeights()" [value]="weight">{{ weight }}</option>
          </select>
        </div>
        <div class="control-row">
          <label>Size</label>
          <input [ngModel]="getStyleValue('fontSize')" (ngModelChange)="updateStyle('fontSize', $event)" placeholder="16px" />
        </div>
        <div class="control-row">
          <label>Line height</label>
          <input [ngModel]="getStyleValue('lineHeight')" (ngModelChange)="updateStyle('lineHeight', $event)" placeholder="1.6" />
        </div>
        <div class="control-row">
          <label>Letter spacing</label>
          <input [ngModel]="getStyleValue('letterSpacing')" (ngModelChange)="updateStyle('letterSpacing', $event)" placeholder="0px" />
        </div>
        <div class="control-row">
          <label>Align</label>
          <select [ngModel]="getStyleValue('textAlign')" (ngModelChange)="updateStyle('textAlign', $event)">
            <option value="left">Left</option>
            <option value="center">Center</option>
            <option value="right">Right</option>
            <option value="justify">Justify</option>
          </select>
        </div>
        <div class="control-row">
          <label>Transform</label>
          <select [ngModel]="getStyleValue('textTransform')" (ngModelChange)="updateStyle('textTransform', $event)">
            <option value="none">None</option>
            <option value="uppercase">Uppercase</option>
            <option value="lowercase">Lowercase</option>
            <option value="capitalize">Capitalize</option>
          </select>
        </div>
        <div class="control-row">
          <label>Decoration</label>
          <select [ngModel]="getStyleValue('textDecoration')" (ngModelChange)="updateStyle('textDecoration', $event)">
            <option value="none">None</option>
            <option value="underline">Underline</option>
            <option value="line-through">Line-through</option>
          </select>
        </div>
        <div class="control-row">
          <label>Color</label>
          <div class="color-row">
            <input type="color" [ngModel]="getStyleValue('color')" (ngModelChange)="updateColor($event)" />
            <input [ngModel]="getStyleValue('color')" (ngModelChange)="updateColor($event)" placeholder="#111111" />
          </div>
        </div>
      </div>
    </details>

    <details class="panel-section" open>
      <summary>Background & Border</summary>
      <div class="section-body">
        <div class="control-row">
          <label>Background</label>
          <div class="color-row">
            <input
              type="color"
              [ngModel]="getStyleValue('backgroundColor')"
              (ngModelChange)="updateStyle('backgroundColor', $event)"
            />
            <input
              [ngModel]="getStyleValue('backgroundColor')"
              (ngModelChange)="updateStyle('backgroundColor', $event)"
              placeholder="#ffffff"
            />
          </div>
        </div>
        <div class="control-row">
          <label>Border width</label>
          <input [ngModel]="getBorderWidth()" (ngModelChange)="updateBorder($event, getBorderStyle(), getBorderColor())" placeholder="1px" />
        </div>
        <div class="control-row">
          <label>Border style</label>
          <select [ngModel]="getBorderStyle()" (ngModelChange)="updateBorder(getBorderWidth(), $event, getBorderColor())">
            <option value="solid">Solid</option>
            <option value="dashed">Dashed</option>
            <option value="dotted">Dotted</option>
            <option value="double">Double</option>
            <option value="none">None</option>
          </select>
        </div>
        <div class="control-row">
          <label>Border color</label>
          <div class="color-row">
            <input type="color" [ngModel]="getBorderColor()" (ngModelChange)="updateBorder(getBorderWidth(), getBorderStyle(), $event)" />
            <input [ngModel]="getBorderColor()" (ngModelChange)="updateBorder(getBorderWidth(), getBorderStyle(), $event)" />
          </div>
        </div>
        <div class="control-row">
          <label>Radius</label>
          <input [ngModel]="getStyleValue('borderRadius')" (ngModelChange)="updateStyle('borderRadius', $event)" placeholder="12px" />
        </div>
        <div class="control-row">
          <label>Shadow</label>
          <input [ngModel]="getStyleValue('boxShadow')" (ngModelChange)="updateStyle('boxShadow', $event)" placeholder="0 8px 30px rgba(0,0,0,0.1)" />
        </div>
      </div>
    </details>

    <details class="panel-section" open>
      <summary>States</summary>
      <div class="section-body">
        <div class="control-row">
          <label>Hover background</label>
          <input [ngModel]="node.styles.hover?.['backgroundColor']" (ngModelChange)="updateStyle('backgroundColor', $event, 'hover')" placeholder="#111111" />
        </div>
        <div class="control-row">
          <label>Hover color</label>
          <input [ngModel]="node.styles.hover?.['color']" (ngModelChange)="updateStyle('color', $event, 'hover')" placeholder="#ffffff" />
        </div>
        <div class="control-row">
          <label>Hover shadow</label>
          <input [ngModel]="node.styles.hover?.['boxShadow']" (ngModelChange)="updateStyle('boxShadow', $event, 'hover')" placeholder="0 10px 25px rgba(0,0,0,0.2)" />
        </div>
        <div class="control-row">
          <label>Hover border</label>
          <input [ngModel]="node.styles.hover?.['border']" (ngModelChange)="updateStyle('border', $event, 'hover')" placeholder="1px solid #4f46e5" />
        </div>
      </div>
    </details>
  </div>

  <ng-template #empty>
    <div class="panel__empty">
      <p>Select a block to edit its properties.</p>
    </div>
  </ng-template>
</div>
