<ng-container [ngSwitch]="node.type">
  <header
    *ngSwitchCase="'header'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    <app-node-renderer
      *ngFor="let child of node.children ?? []; let i = index"
      [node]="child"
      [selectedId]="selectedId"
      [preview]="preview"
      [parentId]="node.id"
      [index]="i"
      [viewport]="viewport"
      (selectNode)="selectNode.emit($event)"
      (startDrag)="startDrag.emit($event)"
      (startResize)="startResize.emit($event)"
      (quickUpdate)="quickUpdate.emit($event)"
      (reorder)="reorder.emit($event)"
    />
    <div
      class="node-dropzone"
      *ngIf="!preview"
      (dragover)="handleDragOver($event)"
      (drop)="handleDropInto($event)"
    >
      <span *ngIf="(node.children ?? []).length === 0">Drop here</span>
    </div>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </header>

  <footer
    *ngSwitchCase="'footer'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    <app-node-renderer
      *ngFor="let child of node.children ?? []; let i = index"
      [node]="child"
      [selectedId]="selectedId"
      [preview]="preview"
      [parentId]="node.id"
      [index]="i"
      [viewport]="viewport"
      (selectNode)="selectNode.emit($event)"
      (startDrag)="startDrag.emit($event)"
      (startResize)="startResize.emit($event)"
      (quickUpdate)="quickUpdate.emit($event)"
      (reorder)="reorder.emit($event)"
    />
    <div
      class="node-dropzone"
      *ngIf="!preview"
      (dragover)="handleDragOver($event)"
      (drop)="handleDropInto($event)"
    >
      <span *ngIf="(node.children ?? []).length === 0">Drop here</span>
    </div>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </footer>

  <section
    *ngSwitchCase="'section'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    <app-node-renderer
      *ngFor="let child of node.children ?? []; let i = index"
      [node]="child"
      [selectedId]="selectedId"
      [preview]="preview"
      [parentId]="node.id"
      [index]="i"
      [viewport]="viewport"
      (selectNode)="selectNode.emit($event)"
      (startDrag)="startDrag.emit($event)"
      (startResize)="startResize.emit($event)"
      (quickUpdate)="quickUpdate.emit($event)"
      (reorder)="reorder.emit($event)"
    />
    <div
      class="node-dropzone"
      *ngIf="!preview"
      (dragover)="handleDragOver($event)"
      (drop)="handleDropInto($event)"
    >
      <span *ngIf="(node.children ?? []).length === 0">Drop here</span>
    </div>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </section>

  <div
    *ngSwitchCase="'container'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    <app-node-renderer
      *ngFor="let child of node.children ?? []; let i = index"
      [node]="child"
      [selectedId]="selectedId"
      [preview]="preview"
      [parentId]="node.id"
      [index]="i"
      [viewport]="viewport"
      (selectNode)="selectNode.emit($event)"
      (startDrag)="startDrag.emit($event)"
      (startResize)="startResize.emit($event)"
      (quickUpdate)="quickUpdate.emit($event)"
      (reorder)="reorder.emit($event)"
    />
    <div
      class="node-dropzone"
      *ngIf="!preview"
      (dragover)="handleDragOver($event)"
      (drop)="handleDropInto($event)"
    >
      <span *ngIf="(node.children ?? []).length === 0">Drop here</span>
    </div>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </div>

  <ng-container *ngSwitchCase="'heading'">
    <ng-container [ngSwitch]="node.content?.tag ?? 'h2'">
      <h1
        *ngSwitchCase="'h1'"
        class="node node-{{ node.id }}"
        [class.node--selected]="isSelected"
        [ngStyle]="computedStyles"
        [attr.draggable]="!preview && parentId ? true : null"
        (click)="handleSelect($event)"
        (mousedown)="handleMouseDown($event)"
        (dragstart)="handleDragStart($event)"
        (dragover)="handleDragOver($event)"
        (drop)="handleDrop($event)"
      >
        {{ node.content?.text }}
        <button
          *ngIf="isSelected && !preview"
          type="button"
          class="quick-toggle"
          (click)="toggleQuick($event)"
        >
          ⚙
        </button>
        <span *ngIf="isSelected && quickOpen && !preview" class="quick-panel" (click)="$event.stopPropagation()">
          <label>Text</label>
          <input [value]="node.content?.text" (input)="handleQuickInput('text', $event)" />
          <label>Tag</label>
          <select [value]="node.content?.tag ?? 'h2'" (change)="handleQuickInput('tag', $event)">
            <option value="h1">h1</option>
            <option value="h2">h2</option>
            <option value="h3">h3</option>
            <option value="h4">h4</option>
            <option value="h5">h5</option>
            <option value="h6">h6</option>
          </select>
        </span>
        <span
          *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
          class="resize-handle"
          (mousedown)="handleResizeMouseDown($event)"
        ></span>
      </h1>
      <h2
        *ngSwitchCase="'h2'"
        class="node node-{{ node.id }}"
        [class.node--selected]="isSelected"
        [ngStyle]="computedStyles"
        [attr.draggable]="!preview && parentId ? true : null"
        (click)="handleSelect($event)"
        (mousedown)="handleMouseDown($event)"
        (dragstart)="handleDragStart($event)"
        (dragover)="handleDragOver($event)"
        (drop)="handleDrop($event)"
      >
        {{ node.content?.text }}
        <button
          *ngIf="isSelected && !preview"
          type="button"
          class="quick-toggle"
          (click)="toggleQuick($event)"
        >
          ⚙
        </button>
        <span *ngIf="isSelected && quickOpen && !preview" class="quick-panel" (click)="$event.stopPropagation()">
          <label>Text</label>
          <input [value]="node.content?.text" (input)="handleQuickInput('text', $event)" />
          <label>Tag</label>
          <select [value]="node.content?.tag ?? 'h2'" (change)="handleQuickInput('tag', $event)">
            <option value="h1">h1</option>
            <option value="h2">h2</option>
            <option value="h3">h3</option>
            <option value="h4">h4</option>
            <option value="h5">h5</option>
            <option value="h6">h6</option>
          </select>
        </span>
        <span
          *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
          class="resize-handle"
          (mousedown)="handleResizeMouseDown($event)"
        ></span>
      </h2>
      <h3
        *ngSwitchCase="'h3'"
        class="node node-{{ node.id }}"
        [class.node--selected]="isSelected"
        [ngStyle]="computedStyles"
        [attr.draggable]="!preview && parentId ? true : null"
        (click)="handleSelect($event)"
        (mousedown)="handleMouseDown($event)"
        (dragstart)="handleDragStart($event)"
        (dragover)="handleDragOver($event)"
        (drop)="handleDrop($event)"
      >
        {{ node.content?.text }}
        <button
          *ngIf="isSelected && !preview"
          type="button"
          class="quick-toggle"
          (click)="toggleQuick($event)"
        >
          ⚙
        </button>
        <span *ngIf="isSelected && quickOpen && !preview" class="quick-panel" (click)="$event.stopPropagation()">
          <label>Text</label>
          <input [value]="node.content?.text" (input)="handleQuickInput('text', $event)" />
          <label>Tag</label>
          <select [value]="node.content?.tag ?? 'h2'" (change)="handleQuickInput('tag', $event)">
            <option value="h1">h1</option>
            <option value="h2">h2</option>
            <option value="h3">h3</option>
            <option value="h4">h4</option>
            <option value="h5">h5</option>
            <option value="h6">h6</option>
          </select>
        </span>
        <span
          *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
          class="resize-handle"
          (mousedown)="handleResizeMouseDown($event)"
        ></span>
      </h3>
      <h4
        *ngSwitchCase="'h4'"
        class="node node-{{ node.id }}"
        [class.node--selected]="isSelected"
        [ngStyle]="computedStyles"
        [attr.draggable]="!preview && parentId ? true : null"
        (click)="handleSelect($event)"
        (mousedown)="handleMouseDown($event)"
        (dragstart)="handleDragStart($event)"
        (dragover)="handleDragOver($event)"
        (drop)="handleDrop($event)"
      >
        {{ node.content?.text }}
        <button
          *ngIf="isSelected && !preview"
          type="button"
          class="quick-toggle"
          (click)="toggleQuick($event)"
        >
          ⚙
        </button>
        <span *ngIf="isSelected && quickOpen && !preview" class="quick-panel" (click)="$event.stopPropagation()">
          <label>Text</label>
          <input [value]="node.content?.text" (input)="handleQuickInput('text', $event)" />
          <label>Tag</label>
          <select [value]="node.content?.tag ?? 'h2'" (change)="handleQuickInput('tag', $event)">
            <option value="h1">h1</option>
            <option value="h2">h2</option>
            <option value="h3">h3</option>
            <option value="h4">h4</option>
            <option value="h5">h5</option>
            <option value="h6">h6</option>
          </select>
        </span>
        <span
          *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
          class="resize-handle"
          (mousedown)="handleResizeMouseDown($event)"
        ></span>
      </h4>
      <h5
        *ngSwitchCase="'h5'"
        class="node node-{{ node.id }}"
        [class.node--selected]="isSelected"
        [ngStyle]="computedStyles"
        [attr.draggable]="!preview && parentId ? true : null"
        (click)="handleSelect($event)"
        (mousedown)="handleMouseDown($event)"
        (dragstart)="handleDragStart($event)"
        (dragover)="handleDragOver($event)"
        (drop)="handleDrop($event)"
      >
        {{ node.content?.text }}
        <button
          *ngIf="isSelected && !preview"
          type="button"
          class="quick-toggle"
          (click)="toggleQuick($event)"
        >
          ⚙
        </button>
        <span *ngIf="isSelected && quickOpen && !preview" class="quick-panel" (click)="$event.stopPropagation()">
          <label>Text</label>
          <input [value]="node.content?.text" (input)="handleQuickInput('text', $event)" />
          <label>Tag</label>
          <select [value]="node.content?.tag ?? 'h2'" (change)="handleQuickInput('tag', $event)">
            <option value="h1">h1</option>
            <option value="h2">h2</option>
            <option value="h3">h3</option>
            <option value="h4">h4</option>
            <option value="h5">h5</option>
            <option value="h6">h6</option>
          </select>
        </span>
        <span
          *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
          class="resize-handle"
          (mousedown)="handleResizeMouseDown($event)"
        ></span>
      </h5>
      <h6
        *ngSwitchCase="'h6'"
        class="node node-{{ node.id }}"
        [class.node--selected]="isSelected"
        [ngStyle]="computedStyles"
        [attr.draggable]="!preview && parentId ? true : null"
        (click)="handleSelect($event)"
        (mousedown)="handleMouseDown($event)"
        (dragstart)="handleDragStart($event)"
        (dragover)="handleDragOver($event)"
        (drop)="handleDrop($event)"
      >
        {{ node.content?.text }}
        <button
          *ngIf="isSelected && !preview"
          type="button"
          class="quick-toggle"
          (click)="toggleQuick($event)"
        >
          ⚙
        </button>
        <span *ngIf="isSelected && quickOpen && !preview" class="quick-panel" (click)="$event.stopPropagation()">
          <label>Text</label>
          <input [value]="node.content?.text" (input)="handleQuickInput('text', $event)" />
          <label>Tag</label>
          <select [value]="node.content?.tag ?? 'h2'" (change)="handleQuickInput('tag', $event)">
            <option value="h1">h1</option>
            <option value="h2">h2</option>
            <option value="h3">h3</option>
            <option value="h4">h4</option>
            <option value="h5">h5</option>
            <option value="h6">h6</option>
          </select>
        </span>
        <span
          *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
          class="resize-handle"
          (mousedown)="handleResizeMouseDown($event)"
        ></span>
      </h6>
    </ng-container>
  </ng-container>

  <p
    *ngSwitchCase="'text'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    {{ node.content?.text }}
    <span
      *ngIf="isSelected && !preview"
      class="quick-toggle"
      role="button"
      tabindex="0"
      (click)="toggleQuick($event)"
    >
      ⚙
    </span>
    <span *ngIf="isSelected && quickOpen && !preview" class="quick-panel" (click)="$event.stopPropagation()">
      <label>Text</label>
      <textarea [value]="node.content?.text" (input)="handleQuickInput('text', $event)"></textarea>
    </span>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </p>

  <div *ngSwitchCase="'image'" class="node-wrapper">
    <img
      class="node node-{{ node.id }}"
      [class.node--selected]="isSelected"
      [ngStyle]="computedStyles"
      [src]="node.content?.src"
      [alt]="node.content?.alt"
      [attr.draggable]="!preview && parentId ? true : null"
      (click)="handleSelect($event)"
      (mousedown)="handleMouseDown($event)"
      (dragstart)="handleDragStart($event)"
      (dragover)="handleDragOver($event)"
      (drop)="handleDrop($event)"
    />
    <button
      *ngIf="isSelected && !preview"
      type="button"
      class="quick-toggle"
      (click)="toggleQuick($event)"
    >
      ⚙
    </button>
    <div *ngIf="isSelected && quickOpen && !preview" class="quick-panel" (click)="$event.stopPropagation()">
      <label>Image URL</label>
      <input [value]="node.content?.src" (input)="handleQuickInput('src', $event)" />
      <label>Alt</label>
      <input [value]="node.content?.alt" (input)="handleQuickInput('alt', $event)" />
      <label>Width</label>
      <input [value]="computedStyles['width']" (input)="handleQuickInput('style:width', $event)" />
    </div>
  </div>

  <a
    *ngSwitchCase="'button'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [href]="preview ? node.content?.href : 'javascript:void(0)'"
    [attr.target]="node.content?.target"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    {{ node.content?.text }}
    <button
      *ngIf="isSelected && !preview"
      type="button"
      class="quick-toggle"
      (click)="toggleQuick($event)"
    >
      ⚙
    </button>
    <span *ngIf="isSelected && quickOpen && !preview" class="quick-panel" (click)="$event.stopPropagation()">
      <label>Label</label>
      <input [value]="node.content?.text" (input)="handleQuickInput('text', $event)" />
      <label>Link</label>
      <input [value]="node.content?.href" (input)="handleQuickInput('href', $event)" />
      <label>Target</label>
      <select [value]="node.content?.target ?? '_self'" (change)="handleQuickInput('target', $event)">
        <option value="_self">Same tab</option>
        <option value="_blank">New tab</option>
      </select>
    </span>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </a>

  <div
    *ngSwitchCase="'divider'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  ></div>

  <div
    *ngSwitchCase="'spacer'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  ></div>

  <ul
    *ngSwitchCase="'list'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    <li *ngFor="let item of listItems">{{ item }}</li>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </ul>

  <div
    *ngSwitchCase="'card'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    <app-node-renderer
      *ngFor="let child of node.children ?? []; let i = index"
      [node]="child"
      [selectedId]="selectedId"
      [preview]="preview"
      [parentId]="node.id"
      [index]="i"
      [viewport]="viewport"
      (selectNode)="selectNode.emit($event)"
      (startDrag)="startDrag.emit($event)"
      (startResize)="startResize.emit($event)"
      (quickUpdate)="quickUpdate.emit($event)"
      (reorder)="reorder.emit($event)"
    />
    <div
      class="node-dropzone"
      *ngIf="!preview"
      (dragover)="handleDragOver($event)"
      (drop)="handleDropInto($event)"
    >
      <span *ngIf="(node.children ?? []).length === 0">Drop here</span>
    </div>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </div>

  <div
    *ngSwitchCase="'columns2'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    <app-node-renderer
      *ngFor="let child of node.children ?? []; let i = index"
      [node]="child"
      [selectedId]="selectedId"
      [preview]="preview"
      [parentId]="node.id"
      [index]="i"
      [viewport]="viewport"
      (selectNode)="selectNode.emit($event)"
      (startDrag)="startDrag.emit($event)"
      (startResize)="startResize.emit($event)"
      (quickUpdate)="quickUpdate.emit($event)"
      (reorder)="reorder.emit($event)"
    />
    <div
      class="node-dropzone"
      *ngIf="!preview"
      (dragover)="handleDragOver($event)"
      (drop)="handleDropInto($event)"
    >
      <span *ngIf="(node.children ?? []).length === 0">Drop here</span>
    </div>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </div>

  <section
    *ngSwitchCase="'hero'"
    class="node node-{{ node.id }}"
    [class.node--selected]="isSelected"
    [ngStyle]="computedStyles"
    [attr.draggable]="!preview && parentId ? true : null"
    (click)="handleSelect($event)"
    (mousedown)="handleMouseDown($event)"
    (dragstart)="handleDragStart($event)"
    (dragover)="handleDragOver($event)"
    (drop)="handleDrop($event)"
  >
    <app-node-renderer
      *ngFor="let child of node.children ?? []; let i = index"
      [node]="child"
      [selectedId]="selectedId"
      [preview]="preview"
      [parentId]="node.id"
      [index]="i"
      [viewport]="viewport"
      (selectNode)="selectNode.emit($event)"
      (startDrag)="startDrag.emit($event)"
      (startResize)="startResize.emit($event)"
      (quickUpdate)="quickUpdate.emit($event)"
      (reorder)="reorder.emit($event)"
    />
    <div
      class="node-dropzone"
      *ngIf="!preview"
      (dragover)="handleDragOver($event)"
      (drop)="handleDropInto($event)"
    >
      <span *ngIf="(node.children ?? []).length === 0">Drop here</span>
    </div>
    <span
      *ngIf="isSelected && !preview && computedStyles['position'] === 'absolute'"
      class="resize-handle"
      (mousedown)="handleResizeMouseDown($event)"
    ></span>
  </section>
</ng-container>
